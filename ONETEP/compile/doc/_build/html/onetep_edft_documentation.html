
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Finite-temperature DFT calculations using the Ensemble-DFT method &#8212; ONETEP Documentation 6.2.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '6.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Running linear-scaling DFT calculations for metallic systems with the AQUA-FOE method" href="AQUA-FOE.html" />
    <link rel="prev" title="Conduction NGWF optimisation and optical absorption spectra" href="conduction.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="finite-temperature-dft-calculations-using-the-ensemble-dft-method">
<h1>Finite-temperature DFT calculations using the Ensemble-DFT method<a class="headerlink" href="#finite-temperature-dft-calculations-using-the-ensemble-dft-method" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Álvaro Ruiz Serrano, University of Southampton</td>
</tr>
<tr class="field-even field"><th class="field-name">Author:</th><td class="field-body">Extended to spin relaxation by Kevin Duff, University of Cambridge</td>
</tr>
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Extended to include Grand Canonical Ensemble by Arihant Bhandari, University of Southampton</td>
</tr>
<tr class="field-even field"><th class="field-name">Author:</th><td class="field-body">Extended to include Pulay mixing and input trial step by Gabriel Bramley, University of Southampton</td>
</tr>
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">August 2013</td>
</tr>
<tr class="field-even field"><th class="field-name">Date:</th><td class="field-body">Extended by Kevin Duff April 2018</td>
</tr>
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">Extended by Arihant Bhandari September 2020</td>
</tr>
<tr class="field-even field"><th class="field-name">Date:</th><td class="field-body">Extended by Gabriel Bramley November 2020</td>
</tr>
</tbody>
</table>
<div class="section" id="basic-principles">
<h2>Basic principles<a class="headerlink" href="#basic-principles" title="Permalink to this headline">¶</a></h2>
<p>This manual describes how to run finite-temperature calculations using
ONETEP. A recent implementation uses a direct minimisation technique
based on the Ensemble-DFT method
[Marzari1997]. The Helmholtz free energy
functional is minimised in two nested loops. The inner loop performs a
line-search in the space of Hamiltonian matrices (in a similar fashion
as described in Ref. [Freysoldt2009]), for
a fixed set of NGWFs. Then, the outer loop optimises the NGWFs psinc
expansion coefficients for a fixed density kernel. For a more detailed
description and discussion of this method in ONETEP, see Ref.
[Ruiz-Serrano2013].</p>
<p>Using the NGWF representation, the Helmholtz free energy functional
becomes:</p>
<div class="math" id="equation-freeenergy2">
<span class="eqno">(1)<a class="headerlink" href="#equation-freeenergy2" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
A_{\mathcal{T}}\left[{\left\lbrace H_{\alpha\beta} \right\rbrace},{\left\lbrace \lvert\phi_\alpha\rangle \right\rbrace}\right]
= E\left[{\left\lbrace H_{\alpha\beta} \right\rbrace},{\left\lbrace \lvert\phi_\alpha\rangle \right\rbrace}\right] -
{\mathcal{T}}S\left[{\left\lbrace f_i \right\rbrace}\right].\end{aligned}\]</div>
<p>where <span class="math">\({\left\lbrace H_{\alpha\beta} \right\rbrace}\)</span> is the NGWF
representation of the Hamiltonian matrix,
<span class="math">\({\left\lbrace \lvert\phi_\alpha\rangle \right\rbrace}\)</span> is the current
set of NGWFs, <span class="math">\({\mathcal{T}}\)</span> is the electronic temperature,
<span class="math">\(E\left[{\left\lbrace H_{\alpha\beta} \right\rbrace},{\left\lbrace \lvert\phi_\alpha\rangle \right\rbrace}\right]\)</span>
is the energy functional and
<span class="math">\(S\left[{\left\lbrace f_i \right\rbrace}\right]\)</span> is an entropy
term. The occupancies of the Kohn-Sham states,
<span class="math">\({\left\lbrace f_i \right\rbrace}\)</span> are calculated from the energy
levels, <span class="math">\({\left\lbrace \epsilon_i \right\rbrace}\)</span>, using the
Fermi-Dirac distribution:</p>
<div class="math">
\[\label{eq:fermidirac}
 f_i\left(\epsilon_i\right) = \left( 1 + \exp\left[\dfrac{\epsilon_i -
 \mu}{{k_\textrm{B}}{\mathcal{T}}}\right] \right)^{-1}.\]</div>
<p>where <span class="math">\(\mu\)</span> is the Fermi level. To obtain the energy eigenvalues,
<span class="math">\({\left\lbrace \epsilon_i \right\rbrace}\)</span>, the Hamiltonian matrix
is diagonalised as:</p>
<div class="math">
\[\label{eq:hamdiag}
 H_{\alpha\beta} {M^\beta_i} = S_{\alpha\beta} {M^\beta_i} \epsilon_i,\]</div>
<p>where <span class="math">\({\left\lbrace S_{\alpha\beta} \right\rbrace}\)</span> are the
elements of the NGWF overlap matrix, and
<span class="math">\({\left\lbrace {M^\beta_i} \right\rbrace}\)</span> are the
expansion coefficients of the Kohn-Sham eigenstates in the NGWF basis
set. At the moment, this is a cubic-scaling operation that requires
dealing dense matrices, which makes it memory-demanding.</p>
</div>
<div class="section" id="free-and-fixed-spin-edft">
<h2>Free- and fixed-spin EDFT<a class="headerlink" href="#free-and-fixed-spin-edft" title="Permalink to this headline">¶</a></h2>
<p>By default in spin polarized runs, the total occupancy of each spin
channel is held fixed; each spin channel has its own Fermi level
determined by this constraint. Alternatively the whole system can be
held at one Fermi level dictated by the conservation of the total number
of electrons in the system, allowing the net spin to freely relax.</p>
<p>Free-spin EDFT should be appropriate for most applications unless
there’s a reason to hold the system fixed at a given net spin. As with
any minimization with potentially many minima, the final state may
depend on initial conditions. As a special case, free-spin EDFT may not
be able to symmetry-break a system that wants to have any kind of spin
polarization but that is initialized to have 0 net spin. The general
advice for simple systems like basic ferromagnets (though this should
not replace good system-specific judgment) is to slightly over-specify
the expected net spin on each atom and hold the spin fixed for a few
iterations before being allowed to relax. For example a cobalt cluster
is expected to have a net spin per atom lower than that of an isolated
atom, that decreases to bulk-like as a function of cluster size. A good
initialization may be to give each atom atomic-like net spin and hold
the net spin fixed for 3-5 NGWF CG iterations, then allow it to relax.</p>
</div>
<div class="section" id="compilation">
<h2>Compilation<a class="headerlink" href="#compilation" title="Permalink to this headline">¶</a></h2>
<p>By default, ONETEP is linked against the Lapack library
[lapack_web] for linear algebra. The Lapack
eigensolver DSYGVX [DSYGVX], can only be executed in
one CPU at a time. Therefore, EDFT calculations with Lapack are limited
to small systems (a few tens of atoms). Calculations on large systems
are possible if, instead, ONETEP is linked against ScaLapack library
[scalapack_web] during compilation time. The ScaLapack
eigensolver, PDSYGVX, can be run in parallel using many CPUs
simultaneously. Moreover, ScaLapack can distribute the storage of dense
matrices across many CPUs, thus allowing to increase the total memory
allocated to a given calculation in a systematic manner, simply by
requesting more processors. For the compilation against ScaLapack to
take effect, the flag <code class="docutils literal"><span class="pre">-DSCALAPACK</span></code> must be specified during the
compilation of ONETEP.</p>
</div>
<div class="section" id="pulay-mixing-edft">
<h2>Pulay Mixing EDFT<a class="headerlink" href="#pulay-mixing-edft" title="Permalink to this headline">¶</a></h2>
<p>In default EDFT, the Hamiltonian is updated using a damped fixed point
update routine:</p>
<div class="math">
\[\label{linearmixing}
     H_{\alpha\beta}^{(m+1)} = H_{\alpha\beta}^{(m)} + \lambda \,  R[H_{\alpha\beta}^{(m)}]\]</div>
<p>Where the <span class="math">\(\lambda\)</span> defines the mixing parameter and residual is
defined as:</p>
<div class="math">
\[\label{residual}
    R[H_{\alpha\beta}^{(m)}] = \tilde{H}_{\alpha\beta}^{(m)} - H_{\alpha\beta}^{(m)}\]</div>
<p>Where <span class="math">\(\tilde{H}_{\alpha\beta}^{(m)}\)</span> is the diagonlised
Hamiltonian obtained at step m. At a sufficiently low value of
<span class="math">\(\lambda\)</span>, most systems will achieve convergence, but at an
increasingly slow rate as the system increases in size. Convergence can
be accelerated using quasi-Newton update methods such as Broyden or
Pulay methods, the latter of which is implemented in EDFT as an
alternative to the damped fixed point method.</p>
<p>The implementation in ONETEP uses a similar logic to other DFT
implementations of Pulay’s method, except the Hamiltonian is optimised
instead of the density:</p>
<div class="math">
\[H_{\alpha\beta}^{(m+1)} =  \sum_{j=m-n+1}^{m} c_j H_{\alpha\beta}^{(j)} +  \lambda \sum_{j=m-n+1}^{m} c_j R[H_{\alpha\beta}^{(j)}]\]</div>
<p>Where the history length is defined <span class="math">\(n\)</span> and the co-efficients
<span class="math">\(c_j\)</span> are obtained through the procedure outlined by Ref.
[Kresse1996]. For the systems tested, this method
leads to improved convergence, especially for larger metallic systems.
Further information can be found in Ref. [Woods2019].</p>
</div>
<div class="section" id="increased-calculation-speed-using-fixed-step-sizes">
<h2>Increased Calculation Speed Using Fixed Step Sizes<a class="headerlink" href="#increased-calculation-speed-using-fixed-step-sizes" title="Permalink to this headline">¶</a></h2>
<p>As described in the Section on Pulay mixing, <span class="math">\(\lambda\)</span> defines the step
length taken at each inner loop iteration. In the default algorithm, an
optimal <span class="math">\(\lambda\)</span> value which gives the greatest decrease in the
Lagrangian is determined by a line search routine. Although this
improves the robustness of the algorithm, the line search requires two
or more energy evaluations per inner loop step to obtain the optimum
<span class="math">\(\lambda\)</span> value. If <span class="math">\(\lambda\)</span> varies very little over the
course of the calculation, this can double the computational expense of
each inner loop iteration for a negligible increase in the accuracy for
each step.</p>
<p>Alternatively, one can fix the <span class="math">\(\lambda\)</span> to a reasonable value for
a significant speed-up by ensuring only one energy evaluation is
performed per inner loop iteration. However, this option is less robust
than the default line search algorithm, as the fixed <span class="math">\(\lambda\)</span>
value may produce either sub-optimal energy decreases or energy
increases for certain steps. Furthermore, if <span class="math">\(\lambda\)</span> is chosen
to be too high, your answer may diverge from the ground state by taking
several consecutive positive Lagrangian steps (A warning will be
provided if this occurs too often). Conversely, convergence will be very
slow if <span class="math">\(\lambda\)</span> is chosen to be too low. <span class="math">\(\lambda\)</span> is set
with the <code class="docutils literal"><span class="pre">edft_trial_step</span></code> keyword, which switches from the line
search algorithm if greater than 0, and uses the fixed <span class="math">\(\lambda\)</span>
value specified.</p>
<p>User input values of <span class="math">\(\lambda\)</span> can be determined by running a
standard EDFT calculation for a single NGWF iteration with line search
and plotting the ’step’ value printed at each iteration (in VERBOSE
output mode). The safest option is to choose a value close to the
minimum step value, but a slightly higher value can be selected,
especially if larger step values are common. The first two steps of your
calculation choose <span class="math">\(\lambda\)</span> with line search regardless of your
input, as optimal step sizes for these iterations are significantly
larger than subsequent inner loop iterations. As such, these two
iterations should be disregarded from your <span class="math">\(\lambda\)</span> value
selection analysis. As step sizes which yield stable convergence are
system dependent, it is recommended to manually determine different
<span class="math">\(\lambda\)</span> values for systems with large differences in species or
size.</p>
</div>
<div class="section" id="commands-for-the-inner-loop">
<h2>Commands for the inner loop<a class="headerlink" href="#commands-for-the-inner-loop" title="Permalink to this headline">¶</a></h2>
<div class="section" id="basic-setup">
<h3>Basic setup<a class="headerlink" href="#basic-setup" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">edft:</span> <span class="pre">T/F</span></code> [Boolean, default <code class="docutils literal"><span class="pre">edft:</span> <span class="pre">F</span></code>]. If true, it enables
Ensemble-DFT calculations.</li>
<li><code class="docutils literal"><span class="pre">edft_maxit:</span> <span class="pre">n</span></code> [Integer, default <code class="docutils literal"><span class="pre">edft_maxit:</span> <span class="pre">10</span></code>]. Number of
EDFT iterations in the ONETEP inner loop.</li>
<li><code class="docutils literal"><span class="pre">edft_smearing_width:</span> <span class="pre">x</span> <span class="pre">units</span></code> [Real physical, default
<code class="docutils literal"><span class="pre">edft_smearing_width:</span> <span class="pre">0.1</span> <span class="pre">eV</span></code>]. Sets the value of the smearing
width, <span class="math">\({k_\textrm{B}}{\mathcal{T}}\)</span>, of the Fermi-Dirac
distribution. It takes units of energy (eV, Hartree) or temperature.
For example, <code class="docutils literal"><span class="pre">edft_smearing_width:</span> <span class="pre">1500</span> <span class="pre">K</span></code> will set
<span class="math">\({\mathcal{T}}=\)</span> 1500 degree Kelvin.</li>
<li><code class="docutils literal"><span class="pre">edft_update_scheme:</span> <span class="pre">damp_fixpoint/pulay_mix</span></code> [Character, default
<code class="docutils literal"><span class="pre">dft_update_scheme:</span> <span class="pre">damp_fixpoint</span></code>]. Defines the mixing scheme for
EDFT in the ONETEP inner loop.</li>
<li><code class="docutils literal"><span class="pre">edft_ham_diis_size:</span> <span class="pre">x</span></code> [Integer, default
<code class="docutils literal"><span class="pre">edft_ham_diis_size:</span> <span class="pre">10</span></code>]. Specifies the maximum number of
Hamiltonians used from previous iterations to generate the new guess
through Pulay mixing.</li>
<li><code class="docutils literal"><span class="pre">spin:</span> <span class="pre">x</span></code> [Real, default <code class="docutils literal"><span class="pre">spin:</span> <span class="pre">0.0</span></code>]. For EDFT runs this value
does not need to be an integer. Because we are considering an
ensemble of states it can have any real value between
<span class="math">\(-\frac{n_\mathrm{elec}}{2}\)</span> to <span class="math">\(\frac{n_\mathrm{elec}}{2}\)</span>. Make sure you
have enough bands to cover the more populated spin channel.</li>
<li><code class="docutils literal"><span class="pre">edft_spin_fix</span></code> [Integer, default <code class="docutils literal"><span class="pre">edft_spin_fix:</span> <span class="pre">-1</span></code>]. Control
for whether the net spin of the system should remain fixed at
<code class="docutils literal"><span class="pre">spin</span></code>, or relax during the run. Any negative number will fix the
net spin. Nonnegative numbers <span class="math">\(n\)</span> will hold the net spin fixed
for <span class="math">\(n\)</span> iterations then let it relax for the rest of the
calculation.</li>
<li><code class="docutils literal"><span class="pre">edft_trial_step</span></code> [Integer, default <code class="docutils literal"><span class="pre">edft_trial_step:</span> <span class="pre">0</span></code>]. Sets
the value of <span class="math">\(\lambda\)</span>, which fixes the step size in the EDFT
inner loop, and switches off the line search for optimum
<span class="math">\(\lambda\)</span> values. If set to 0, the normal line search routine
is used.</li>
</ul>
</div>
<div class="section" id="tolerance-thresholds">
<h3>Tolerance thresholds<a class="headerlink" href="#tolerance-thresholds" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">edft_free_energy_thres:</span> <span class="pre">x</span> <span class="pre">units</span></code> [Real physical, default
<code class="docutils literal"><span class="pre">edft_free_energy_thres:</span> <span class="pre">1.0e-6</span> <span class="pre">Ha/Atom</span></code>]. Maximum difference in the
Helmholtz free energy functional per atom between two consecutive
iterations.</li>
<li><code class="docutils literal"><span class="pre">edft_energy_thres:</span> <span class="pre">x</span> <span class="pre">units</span></code> [Real physical, default
<code class="docutils literal"><span class="pre">edft_energy_thres:</span> <span class="pre">1.0e-6</span> <span class="pre">Ha/Atom</span></code>]. Maximum difference in the
energy functional per atom between two consecutive iterations.</li>
<li><code class="docutils literal"><span class="pre">edft_entropy_thres:</span> <span class="pre">x</span> <span class="pre">units</span></code> [Real physical, default
<code class="docutils literal"><span class="pre">edft_entropy_thres:</span> <span class="pre">1.0e-6</span> <span class="pre">Ha/Atom</span></code>]. Maximum difference in the
entropy per atom functional between two consecutive iterations.</li>
<li><code class="docutils literal"><span class="pre">edft_rms_gradient_thres:</span> <span class="pre">x</span></code> [Real, default
<code class="docutils literal"><span class="pre">edft_rms_gradient_thres:</span> <span class="pre">1.0e-4</span></code>]. Maximum RMS gradient
<span class="math">\(\dfrac{d A_{\mathcal{T}}}{d f_i}\)</span>.</li>
<li><code class="docutils literal"><span class="pre">edft_commutator_thres:</span> <span class="pre">x</span> <span class="pre">units</span></code> [Real physical, default
<code class="docutils literal"><span class="pre">edft_commutator_thres:</span> <span class="pre">1.0e-5</span> <span class="pre">Hartree</span></code>]. Maximum value of the
Hamiltonian-Kernel commutator.</li>
<li><code class="docutils literal"><span class="pre">edft_fermi_thres:</span> <span class="pre">x</span> <span class="pre">units</span></code> [Real physical, default
<code class="docutils literal"><span class="pre">edft_fermi_thres:</span> <span class="pre">1.0e-3</span> <span class="pre">Hartree</span></code>]. Maximum change in the Fermi
energy between two consecutive iterations.</li>
</ul>
</div>
<div class="section" id="advanced-setup">
<h3>Advanced setup<a class="headerlink" href="#advanced-setup" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">edft_extra_bands:</span> <span class="pre">n</span></code> [Integer, default
<code class="docutils literal"><span class="pre">edft_extra_bands:</span> <span class="pre">-1</span></code>]. Number of extra energy bands. The total
number of bands is equal to the number of NGWFs plus
<code class="docutils literal"><span class="pre">edft_extra_bands</span></code>. When set to a negative number, no extra bands
are added.</li>
<li><code class="docutils literal"><span class="pre">edft_round_evals:</span> <span class="pre">n</span></code> [Integer, default
<code class="docutils literal"><span class="pre">edft_round_evals:</span> <span class="pre">-1</span></code>]. When set to a positive integer value, the
occupancies that result from the Fermi-Dirac distribution are rounded
to <code class="docutils literal"><span class="pre">n</span></code> significant figures. This feature can reduce some numerical
errors arising from the grid-based representation of the NGWFs.</li>
<li><code class="docutils literal"><span class="pre">edft_write_occ:</span> <span class="pre">T/F</span></code> [Boolean, default <code class="docutils literal"><span class="pre">edft_write_occ:</span> <span class="pre">F</span></code>]. Save
fractional occupancies in a file.</li>
<li><code class="docutils literal"><span class="pre">edft_max_step:</span> <span class="pre">x</span></code> [Real, default <code class="docutils literal"><span class="pre">edft_max_step:</span> <span class="pre">1.0</span></code>]. Maximum
step during the EDFT line search.</li>
</ul>
</div>
</div>
<div class="section" id="commands-for-the-outer-loop">
<h2>Commands for the outer loop<a class="headerlink" href="#commands-for-the-outer-loop" title="Permalink to this headline">¶</a></h2>
<p>The standard ONETEP commands for NGWF optimisation apply to the EDFT
calculations as well. The only flag that is different is:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ngwf_cg_rotate:</span> <span class="pre">T/F</span></code> [Integer, default <code class="docutils literal"><span class="pre">ngwf_cg_rotate:</span> <span class="pre">T</span></code>].
This flag is always true in EDFT calculations. It ensures that the
eigenvectors <span class="math">\({M^\beta_i}\)</span> are rotated to the new
NGWF representation once these are updated.</li>
</ul>
</div>
<div class="section" id="restarting-an-edft-calculation">
<h2>Restarting an EDFT calculation<a class="headerlink" href="#restarting-an-edft-calculation" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">write_hamiltonian:</span> <span class="pre">T/F</span></code> [Boolean, default
<code class="docutils literal"><span class="pre">write_hamiltonian:</span> <span class="pre">F</span></code>]. Save the last Hamiltonian matrix on a file.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">read_hamiltonian:</span> <span class="pre">T/F</span></code> [Boolean, default
<code class="docutils literal"><span class="pre">read_hamiltonian:</span> <span class="pre">F</span></code>]. Read the Hamiltonian matrix from a file, and
continue the calculation from this point.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">write_tightbox_ngwfs:</span> <span class="pre">T/F</span></code> [Boolean, default
<code class="docutils literal"><span class="pre">write_tightbox_ngwfs:</span> <span class="pre">T</span></code>]. Save the last NGWFs on a file.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">read_tightbox_ngwfs:</span> <span class="pre">T/F</span></code> [Boolean, default
<code class="docutils literal"><span class="pre">read_tightbox_ngwfs:</span> <span class="pre">F</span></code>]. Read the NGWFs from a file and continue
the calculation from this point.</p>
<div class="line-block">
<div class="line">If a calculation is intended to be restarted at some point in the
future, then run the calculation with</div>
<div class="line"><code class="docutils literal"><span class="pre">write_tightbox_ngwfs:</span> <span class="pre">T</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">write_hamiltonian:</span> <span class="pre">T</span></code></div>
<div class="line">to save the Hamiltonian and the NGWFs on disk. Two new files will
be created, with extensions <code class="docutils literal"><span class="pre">.ham</span></code> and <code class="docutils literal"><span class="pre">.tightbox_ngwfs</span></code>,
respectively. Then, to restart the calculation, set</div>
<div class="line"><code class="docutils literal"><span class="pre">read_tightbox_ngwfs:</span> <span class="pre">T</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">read_hamiltonian:</span> <span class="pre">T</span></code></div>
<div class="line">to tell ONETEP to read the files that were previously saved on
disk. Remember to keep a backup of the output of the first run
before restarting the calculation.</div>
</div>
<div class="line-block">
<div class="line">the density kernel is not necessary to restart an EDFT calculation.
However, it is necessary to calculate the electronic properties of
the system, once the energy minimisation has completed. To save the
density kernel on a file, set: <code class="docutils literal"><span class="pre">write_denskern:</span> <span class="pre">T</span></code></div>
<div class="line">to generate a <code class="docutils literal"><span class="pre">.dkn</span></code> file containing the density kernel. To read
in the density kernel, set</div>
<div class="line"><code class="docutils literal"><span class="pre">read_denskern:</span> <span class="pre">T</span></code></div>
</div>
</li>
</ul>
</div>
<div class="section" id="controlling-the-parallel-eigensolver">
<h2>Controlling the parallel eigensolver<a class="headerlink" href="#controlling-the-parallel-eigensolver" title="Permalink to this headline">¶</a></h2>
<p>Currently, only the ScaLapack PDSYGVX parallel eigensolver is available.
A complete manual to this routine can be found by following the link in
Ref. [PDSYGVX]. If ONETEP is interfaced to ScaLapack,
the following directives can be used:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">eigensolver_orfac:</span> <span class="pre">x</span></code> [Real, default
<code class="docutils literal"><span class="pre">eigensolver_orfac:</span> <span class="pre">1.0e-4</span></code>]. Precision to which the eigensolver
will orthogonalise degenerate Hamiltonian eigenvectors. Set to a
negative number to avoid reorthogonalisation with the ScaLapack
eigensolver.</li>
<li><code class="docutils literal"><span class="pre">eigensolver_abstol:</span> <span class="pre">x</span></code> [Real, default
<code class="docutils literal"><span class="pre">eigensolver_abstol:</span> <span class="pre">1.0e-9</span></code>]. Precision to which the parallel
eigensolver will calculate the eigenvalues. Set to a negative number
to use ScaLapack defaults.</li>
</ul>
<p>The abovementioned directives are useful in calculations where the
ScaLapack eigensolver fails to orthonormalise the eigenvectors. In such
cases, the following error will be printed in the input file:</p>
<p><code class="docutils literal"><span class="pre">(P)DSYGVX</span> <span class="pre">in</span> <span class="pre">subroutine</span> <span class="pre">dense_eigensolve</span> <span class="pre">returned</span> <span class="pre">info=</span> <span class="pre">2</span></code>.</p>
<div class="line-block">
<div class="line">Many times (although not always) this error might cause the
calculation to fail. If this situation occurs, set</div>
<div class="line"><code class="docutils literal"><span class="pre">eigensolver_orfac:</span> <span class="pre">-1</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">eigensolver_abstol:</span> <span class="pre">-1</span></code></div>
<div class="line">in the input file and restart the calculation. ScaLapack will not
reorthonormalise the eigenvectors. Instead, an external Löwdin
orthonormalisation process [Lowdin1950] will be
triggered. This is usually more efficient for larger systems.</div>
</div>
</div>
<div class="section" id="grand-canonical-ensemble-dft">
<h2>Grand Canonical Ensemble DFT<a class="headerlink" href="#grand-canonical-ensemble-dft" title="Permalink to this headline">¶</a></h2>
<p>In simulations of electrochemical electrodes, the electrons can freely
exchange between the electrode and the electrical circuit. So, there is
no constraint on the number of electrons <span class="math">\(N\)</span>. Rather, the
electrode potential <span class="math">\(U\)</span> is fixed, with respect to a reference
electrochemical potential <span class="math">\(\mu_{ref}\)</span> which fixes the chemical
potential of electrons <span class="math">\(\mu\)</span>:</p>
<div class="math">
\[\mu = \mu_{ref} -eU\]</div>
<p>Typical experiments use a standard hydrogen electrode as the reference
electrode with <span class="math">\(\mu_{ref}^{SHE}=-4.44\)</span> eV. Once the chemical
potential of electrons is fixed, the number of electrons changes as a
dependent variable according to the Fermi-Dirac distribution in eq. .</p>
<div class="math">
\[N = \sum_i f_i\]</div>
<p>Thermodynamically, this corresponds to switching the electrons from the
finite-temperature, fixed-number canonical ensemble to the
finite-temperature, fixed-potential grand-canonical ensemble.
Correspondingly, the relevant free energy minimized at equilibrium is
the grand potential [Sundararaman2017]:</p>
<div class="math">
\[\Omega = A -\mu N\]</div>
<p>The following keywords are used for the grand-canonical ensemble DFT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">edft_grand_canonical:</span> <span class="pre">T/F</span></code> [Boolean, default
<code class="docutils literal"><span class="pre">edft_grand_canonical:</span> <span class="pre">F</span></code>]. Switch to fixed-potential
grand-canonical ensemble.</li>
<li><code class="docutils literal"><span class="pre">edft_reference_potential:</span> <span class="pre">x</span> <span class="pre">units</span></code> [Real physical, default
<code class="docutils literal"><span class="pre">edft_reference_potential:</span> <span class="pre">-4.44</span> <span class="pre">eV</span></code>]. Set the reference potential
<span class="math">\(\mu_{ref}\)</span>. If no units are given, atomic units are
considered: Ha (hartrees).</li>
<li><code class="docutils literal"><span class="pre">edft_electrode_potential:</span> <span class="pre">x</span> <span class="pre">units</span></code> [Real physical, default
<code class="docutils literal"><span class="pre">edft_electrode_potential:</span> <span class="pre">0.0</span> <span class="pre">V</span></code>]. Set the electrode potential
<span class="math">\(U\)</span>. If no units are given, atomic units are considered: Ha/e,
hartrees per elementary charge.</li>
<li><code class="docutils literal"><span class="pre">edft_nelec_thres:</span> <span class="pre">x</span></code> [Real, default
<code class="docutils literal"><span class="pre">edft_nelec_thres:</span> <span class="pre">1.0e-06</span> <span class="pre">per</span> <span class="pre">atom</span></code>]. Convergence threshold on the
change in number of electrons per spin channel per atom.</li>
</ul>
<p>[Sundararaman2017] R. Sundararaman, W. Goddard, and T. Arias. J. Chem. Phys., 146(11):114104, 2017.</p>
<p>[Marzari1997] N.&nbsp;Marzari, D.&nbsp;Vanderbilt, and M.&nbsp;C. Payne. Phys. Rev. Lett., 79(7):1337–1340, 1997.</p>
<p>[Freysoldt2009] C.&nbsp;Freysoldt, S.&nbsp;Boeck, and J.&nbsp;Neugebauer. Phys. Rev. B, 79(24):241103, 2009.</p>
<p>[Ruiz-Serrano2013] A.&nbsp;Ruiz-Serrano and C.-K. Skylaris. A variational method for density functional theory calculations on metallic systems with thousands of atoms. J. Chem. Phys., 139(5):054107, 2013.</p>
<p>[Lapack_web] Lapack. <a class="reference external" href="http://www.netlib.org/lapack/">http://www.netlib.org/lapack/</a>.</p>
<p>[DSYGVX] Lapack DSYGVX eigensolver. <a class="reference external" href="http://netlib.org/lapack/double/dsygvx.f">http://netlib.org/lapack/double/dsygvx.f</a>.</p>
<p>[Scalapack_web] ScaLapack. <a class="reference external" href="http://www.netlib.org/scalapack/">http://www.netlib.org/scalapack/</a>.</p>
<p>[PDSYGVX] ScaLapack PDSYGVX eigensolver. <a class="reference external" href="http://www.netlib.org/scalapack/double/pdsygvx.f">http://www.netlib.org/scalapack/double/pdsygvx.f</a>.</p>
<p>[Lowdin1950] Per-Olov Lowdin. On the non-orthogonality problem connected with the use of atomic wave functions in the theory of molecules and crystals. J. Chem. Phys., 18(3):365–375, 1950.</p>
<p>[Kresse1996] G.&nbsp;Kresse and J.&nbsp;Furthmüller. Efficient iterative schemes for <em>ab initio</em> total-energy calculations using a plane-wave basis set. Phys. Rev. B, 54:11169, 1996.</p>
<p>[Woods2019] N.&nbsp;Woods, M.&nbsp;Payne and P.&nbsp;Hasnip. Computing the self-consistent field in Kohn–Sham density functional theory J. Phys. Condens. Matter, 31:453001, 2019.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="index_ground_state.html">Ground State Calculation Setup</a><ul>
      <li>Previous: <a href="conduction.html" title="previous chapter">Conduction NGWF optimisation and optical absorption spectra</a></li>
      <li>Next: <a href="AQUA-FOE.html" title="next chapter">Running linear-scaling DFT calculations for metallic systems with the AQUA-FOE method</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Joseph Prentice.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.7</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="_sources/onetep_edft_documentation.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>