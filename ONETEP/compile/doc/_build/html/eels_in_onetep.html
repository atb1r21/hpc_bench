
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Electron Energy Loss Calculations &#8212; ONETEP Documentation 6.2.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '6.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Electronic transport calculations" href="transport.html" />
    <link rel="prev" title="Linear response time-dependent density-functional theory (LR-TDDFT)" href="lr_tddft.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="electron-energy-loss-calculations">
<h1>Electron Energy Loss Calculations<a class="headerlink" href="#electron-energy-loss-calculations" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Edward Tait, University of Cambridge</td>
</tr>
<tr class="field-even field"><th class="field-name">Author:</th><td class="field-body">Nicholas Hine, University of Warwick</td>
</tr>
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">September 2015</td>
</tr>
<tr class="field-even field"><th class="field-name">Date:</th><td class="field-body">Updated and Converted by NDMH September 2022</td>
</tr>
</tbody>
</table>
<div class="section" id="theory">
<h2>Theory<a class="headerlink" href="#theory" title="Permalink to this headline">¶</a></h2>
<p>Computation of Electron Energy Loss (EEL) spectra in the Kohn-Sham formal-
ism relies on the application of Fermi’s Golden Rule to compute the imaginary
part of the dielectric function,</p>
<div class="math">
\[\epsilon_2(\omega) = \frac{1}{\Omega} \sum\limits_{c}\sum\limits_{i} |\langle  \psi_i| \exp(i\mathbf{r}\cdot\mathbf{q})
| \psi_c \rangle |^2 \delta (E_i - E_c - \omega)\,,\]</div>
<p>Here <span class="math">\(\omega\)</span> is the transition energy, <span class="math">\(\Omega\)</span> the unit cell
volume, the <span class="math">\(\psi_i\)</span> are (all electron) conduction band states,
the <span class="math">\(\psi_c\)</span> are core states, with respective energies <span class="math">\(E_i\)</span>
and <span class="math">\(E_c\)</span>. <span class="math">\(\mathbf{r}\)</span> is the position operator
(defined as the displacement from the nucleus
whose core electrons are being excited). The <span class="math">\(\delta\)</span>-function
conserves energy. <span class="math">\(\textsc{ONETEP}\)</span> relies on the external tool
OptaDoS[1] for the computation of <span class="math">\(\epsilon_2\)</span>
and only needs to supply matrix elements in a compatible form. The rest of
this section discusses the calculation of these elements.</p>
<div class="section" id="projector-augmented-wave">
<h3>Projector Augmented Wave<a class="headerlink" href="#projector-augmented-wave" title="Permalink to this headline">¶</a></h3>
<p>In common with many plane wave codes onetep uses pseudopotentials to increase
computational efficiency. A drawback of pseudopotentials is poor
representation of the all-electron Kohn-Sham wavefunction close to the nucleus,
this however is exactly the region in which the matrix elements used for EELS
simulation are computed.
To overcome this obstacle the projector augmented wave (PAW) formalism
of Blochl[2] is adopted, which permits reconstruction of all-electron
states <span class="math">\(\psi\)</span>
(and thus matrix elements) from pseudo-wavefunctions <span class="math">\(\widetilde{\psi}\)</span>:</p>
<div class="math" id="equation-paw-matel">
<span class="eqno">(1)<a class="headerlink" href="#equation-paw-matel" title="Permalink to this equation">¶</a></span>\[\langle \phi_\alpha \vert \hat{O} \vert b \rangle =
\underbrace{ \langle \phi_\alpha \vert  \hat{O} \vert b\rangle }_\text{Cartesian Grid} +
\sum_{i}\langle \phi_\alpha \vert \widetilde{p}_\text{i}\rangle\underbrace{(\langle \varphi_\text{i} \vert  \hat{O}
\vert b \rangle -
\langle \widetilde{\varphi}_\text{i}
\vert  \hat{O} \vert b \rangle)}_\text{Radial Grids}\]</div>
<p>This process is accomplished by decomposing the pseudo-wavefunction in
the augmentation region into a sum of pseudo partial waves, <span class="math">\(\widetilde{\varphi}_i\)</span>, the weights in
this sum are determined using the projectors <span class="math">\(\widetilde{p}_i\)</span>.
These pseudo partial waves are
subtracted off and all electron partial waves, <span class="math">\(\varphi_i\)</span>, added in their place.
Simply put, within the augmentation regions (close to the nucleus) the pseudised part
of pseudo-wavefunction is subtracted off and the all electron part is added back
on.</p>
<p>Several PAW data sets are freely available (subject to the caveat that they
should be thoroughly tested for a specific use case). onetep accepts PAW
pseudopotentials in the abinit file format. Core wavefunctions, as produced
by the pseudopotential generator are also required, these are less frequently
available for download, but your PAW library should provide input files for a
pseudopotential generator which can be used to produce core wavefunction data
sets (again in the abinit format).</p>
</div>
<div class="section" id="generation-of-position-core-kets">
<h3>Generation of Position-Core Kets<a class="headerlink" href="#generation-of-position-core-kets" title="Permalink to this headline">¶</a></h3>
<p>To calculate the PAW matrix elements we must compute terms of the form:
<span class="math">\(\langle\widetilde{\psi}|\mathbf{r}|\psi_\mathrm{c}\rangle\)</span></p>
<p>As an intermediate we compute expressions of the form:
<span class="math">\(\langle\phi_\alpha|\mathbf{r}|\psi_\mathrm{c}\rangle\)</span></p>
<p>with <span class="math">\(\phi_\alpha\)</span> an NGWF. The integral implied by this bra-ket must be computed
on the grid. The bra term, an NGWF, is readily available in this form but the
ket <span class="math">\(|\psi_\mathrm{c}\rangle\)</span> must be constructed.</p>
<p>A Fourier space method is used, as it was found
to offer superior numerical performance and correctly treats periodic systems
without further modification. This method exploits the fact that differentiation
in Fourier space is equivalent to multiplication by the position vector in real
space:</p>
<div class="math">
\[\begin{split}\begin{aligned}
\psi_{\rm c}(\mathbf{r}) &amp;= \sum\limits_\mathbf{G}^{\mathbf{G}_{\rm max}} \exp(i\mathbf{G}\cdot\mathbf{r}) \\
\rightarrow \sum\limits_\mathbf{G}^{\mathbf{G}_{\rm max}}( \nabla_\mathbf{G}(\psi_{\rm c}(\mathbf{G}))\exp(i\mathbf{G}\cdot\mathbf{r}) &amp;= \sum\limits_\mathbf{G}^{\mathbf{G}_{\rm max}}( \nabla_\mathbf{G}(\psi_{\rm c}(\mathbf{G})\exp(i\mathbf{G}\cdot\mathbf{r})) \\
&amp;-\sum\limits_\mathbf{G}^{\mathbf{G}_{\rm max}} \psi_{\rm c}(\mathbf{G}) \nabla_\mathbf{G} \exp(i\mathbf{G}\cdot\mathbf{r}) \\
&amp;=-\sum\limits_\mathbf{G}^{\mathbf{G}_{\rm max}} i \mathbf{r} \psi_{\rm c}(\mathbf{G}) \exp(i\mathbf{G}\cdot\mathbf{r})) \\
&amp;=-i\mathbf{r}  \psi_{\rm c}(\mathbf{r})
\end{aligned}\end{split}\]</div>
</div>
<div class="section" id="conduction-optimisation">
<h3>Conduction Optimisation<a class="headerlink" href="#conduction-optimisation" title="Permalink to this headline">¶</a></h3>
<p>Core loss calculations rely on an accurate description of conduction band states,
in onetep it is necessary to perform a conduction optimisation calculation in
order to obtain a second NGWF set and kernel which correctly represent the
conduction manifold. Detail of the process may be found in the document
“Conduction NGWF optimisation and optical absorption spectra in ONETEP”[3]
and is published[4].</p>
<p>Two main parameters should be supplied: <code class="docutils literal"><span class="pre">cond_energy_range</span></code> which sets the
energy window above the HOMO in which conduction states will be optimised.
The second parameter cond energy gap
specifies the energy gap between the highest optimised state and the lowest un-
optimised state, this parameter is used to prevent attempts to optimise only
part of a set of degenerate states</p>
</div>
</div>
<div class="section" id="practical-example">
<h2>Practical Example<a class="headerlink" href="#practical-example" title="Permalink to this headline">¶</a></h2>
<p>In this section we will discuss the procedure for running an EELS calculation
on a toy system: silene (the silicon equivalent of ethene). You will need to
obtain PAW pseudopotentials for Silicon and Hydrogen and the associated core
wavefunction data for Silicon. The author used the JTH pseudopotentials[5],
though can’t offer any guarantee of their suitability for any particular use.
A boilerplate input file for a onetep EELS calculation is provided in Appendix B.</p>
<p>This input file can also be downloaded from the tutorials section of the
onetep site. There are a few differences between this input and the one for a
single point calculation:</p>
<ul class="simple">
<li>PAW is mandatory</li>
<li>We specify a second species for the atom whose core electrons we’re exciting</li>
<li>Because a conduction calculation is being performed we must provide a species cond block</li>
<li>We must provide a <code class="docutils literal"><span class="pre">species_core_wf</span></code> block and every species must be listed there.</li>
</ul>
<p>The input file can be run swiftly on a single node and should produce a
large number of output files. Most of these files are <code class="docutils literal"><span class="pre">.cube</span></code>’s of wavefunctions
produced by default during the properties calculations. The files of interest
are the <code class="docutils literal"><span class="pre">.elnes_bin</span></code> files, which contain OptaDoS compatible matrix elements.</p>
<p>A little more setup is needed before we can run OptaDoS (using the silene
example):</p>
<ul class="simple">
<li>A dummy castep <code class="docutils literal"><span class="pre">silene-out.cell</span></code> file must be produced, and it must contain a symmetry block</li>
<li>By default two <code class="docutils literal"><span class="pre">.elnes</span> <span class="pre">bin</span></code> files are produced, one based on Kohn-Sham wavefunctions represented using only the valence NGWFs (<code class="docutils literal"><span class="pre">silene_val_grad.elnes_bin</span></code>) and a second which makes use of the joint basis of valence and conduction NGWFs (<code class="docutils literal"><span class="pre">silene_joint_grad.elnes_bin</span></code>)</li>
<li>As per the discussion above, you should choose the latter and copy it to <code class="docutils literal"><span class="pre">silene.elnes</span> <span class="pre">bin</span></code>.</li>
<li>A <code class="docutils literal"><span class="pre">silene.bands</span></code> file must be produced, this is best done by copying <code class="docutils literal"><span class="pre">silene.joint</span> <span class="pre">bands</span></code> to <code class="docutils literal"><span class="pre">silene.bands</span></code>.</li>
<li>An OptaDoS input file, <code class="docutils literal"><span class="pre">silene.odi</span></code> is needed.</li>
</ul>
<p>To assist in these tasks a utility script, <code class="docutils literal"><span class="pre">prep_optados_eels</span></code>, is provided in the
utils folder of the onetep distribution. Run it with the calculation seed name
as its argument and the steps listed above will be completed automatically.</p>
<p>The .odi file produced should be regarded as a basic template, consult the
OptaDoS documentation[6] if you wish to use more advanced features. Note
that at the moment only fixed broadening is supported by onetep.
When you are satisfied with your OptaDoS input file, execute OptaDoS
with your calculation seed name as the argument. All being well, you should
see a .dat file which you can plot with your favorite tool. Individual edges are
listed sequentially in the file, so a little post processing with awk or python is
needed to separate the edges for individual plotting</p>
</div>
<div class="section" id="optados">
<h2>OptaDoS<a class="headerlink" href="#optados" title="Permalink to this headline">¶</a></h2>
<p>The OptaDoS code provides a single tool to compute densities of states and
optical spectra of various sorts. OptaDoS provides a number of smearing
schemes for evaluating integrals over the Brillouin Zone including fixed and
adaptive schemes. At present onetep only supports simple fixed broadening
schemes. The prep optados eels utility script provides a template .odi input
file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TASK</span> <span class="p">:</span> <span class="n">CORE</span>

<span class="c1"># Method OptaDoS should use to work out</span>
<span class="c1"># the Fermi energy in the material .</span>
<span class="c1"># the insulator method relies on electron</span>
<span class="c1"># counting and is best for the systems</span>
<span class="c1"># onetep is most commonly used to study .</span>
<span class="n">EFERMI</span> <span class="p">:</span> <span class="n">insulator</span>

<span class="c1"># Smearing scheme and width</span>
<span class="n">BROADENING</span> <span class="p">:</span> <span class="n">fixed</span>
<span class="n">DOS_SPACING</span> <span class="p">:</span> <span class="mf">0.01</span>

<span class="c1"># Use an average of x , y and z components of</span>
<span class="c1"># the position vector matrix elements</span>
<span class="n">CORE_GEOM</span> <span class="p">:</span> <span class="n">polycrystalline</span>

<span class="c1"># Parameters below control lifetime and</span>
<span class="c1"># instrument broadening</span>
<span class="n">CORE_LAI_BROADENING</span> <span class="p">:</span> <span class="n">true</span>
<span class="n">LAI_GAUSSIAN_WIDTH</span> <span class="p">:</span> <span class="mf">0.6</span>
<span class="n">LAI_LORENTZIAN_WIDTH</span> <span class="p">:</span> <span class="mf">0.2</span>
<span class="n">LAI_LORENTZIAN_SCALE</span> <span class="p">:</span> <span class="mf">0.1</span>
</pre></div>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">[1] RJ Nicholls, AJ Morris, CJ Pickard, and JR Yates. Optados-a new tool
for eels calculations. In Journal of Physics: Conference Series, volume 371,
page 012062. IOP Publishing, 2012.</div>
<div class="line">[2] Peter E Blochl. Projector augmented-wave method. Physical Review B,
50(24):17953, 1994.</div>
<div class="line">[3] Laura E. Ratcliff. Conduction NGWF optimisation and optical absorption
spectra in onetep. <a class="reference external" href="http://www2.tcm.phy.cam.ac.uk/onetep/pmwiki/">http://www2.tcm.phy.cam.ac.uk/onetep/pmwiki/</a>
uploads/Main/Documentation/conduction.pdf, 2011. [Online; accessed
22-Sept-2015].</div>
<div class="line">[4] Laura E Ratcliff, Nicholas DM Hine, and Peter D Haynes. Calculating op-
tical absorption spectra for large systems using linear-scaling density func-
tional theory. Physical Review B, 84(16):165131, 2011.</div>
<div class="line">[5] Francois Jollet, Marc Torrent, and Natalie Holzwarth. Generation of projec-
tor augmented-wave atomic data: A 71 element validated table in the XML
format. Computer Physics Communications, 185(4):1246 – 1254, 2014.</div>
<div class="line">[6] Andrew J. Morris, Rebecca J. Nicholls, Chris J. Pickard, and Jonathan R.
Yates. OptaDoS user guide. <a class="reference external" href="http://www.cmmp.ucl.ac.uk/~ajm/">http://www.cmmp.ucl.ac.uk/~ajm/</a>
optados/files/user_guide_1.0.pdf, 2014. [Online; accessed 22-Sept-
2015]</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="index_spectroscopy.html">Spectroscopy and Transport</a><ul>
      <li>Previous: <a href="lr_tddft.html" title="previous chapter">Linear response time-dependent density-functional theory (LR-TDDFT)</a></li>
      <li>Next: <a href="transport.html" title="next chapter">Electronic transport calculations</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Joseph Prentice.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.7</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="_sources/eels_in_onetep.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>