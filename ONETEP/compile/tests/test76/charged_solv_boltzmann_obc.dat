!=========================================================!
! Input for calculation with the ONETEP program           !
!                                                         !
! Quality Control file for:                               !
! Implicit solvation of a charged solute in electrolyte,  !
! Open Boundary Conditions.                               !
!                                                         !
! Test system: 1-methylpiperidin-1-ium, C6H14N+.          !
!                                                         !
! Features tested:                                        !
!  - Poisson-Boltzmann implicit solvation (solvation in   !
!    the presence of an electrolyte) -- code paths with   !
!    'pub_is_pbe' different from 'NONE', particularly the !
!    generation of accessibility distribution, operation  !
!    of DL_MG in the FULL PBE mode, Debye-screening       !
!    correction to multigrid BCs, the additional free     !
!    energy terms from the FULL treatment of the electro- !
!    lyte, behaviour of Boltzmann ions in the presence of !
!    a *charged* solute, under Open Boundary Conditions.  !
!                                                         !
! Created by J. Dziedzic on 08/10/2019, structure borrowed!
! from QC test #27 (created by S. Fox and J. Dziedzic on  !
! 13/12/2010).                                            !
!                                                         !
! School of Chemistry                                     !
! University of Southampton                               !
! Highfield                                               !
! Southampton SO17 1BJ                                    !
! UK                                                      !
!                                                         !
!=========================================================!

 ! Uncomment to use defect correction code in ONETEP, rather than the default,
 ! which is to have DL_MG perform defect correction
 !devel_code: MG:USE_ONETEP_DEFCO=T:MG

 ! This test does not restart from a converged vacuum calculation,
 ! and uses a rather coarse grid, which both impact convergence. 
 ! Furthermore, only two NGWF iterations are performed. 
 ! For these reasons the obtained total energy is not very meaningful
 ! and neither are the forces.
 ! This is a Quality Control test, not a production calculation.

 write_forces F

 ! --- Poisson-Boltzmann parameters ---
 is_pbe                    full
 is_pbe_temperature        300.0
 is_pbe_bc_debye_screening T

 is_steric_pot_type M ! smoothed hard-sphere potential

 ! Electronic-isovalue-based component to the electrolyte accessibility
 ! radius. This models the solute and is hopefully reasonably transferable.
 ! The below is reasonable, but not a final parameterisation.
 is_hc_steric_dens_isovalue 0.002

 ! Constant offset component to the electrolyte accessibility radius.
 ! This models the electrolyte and so will depend on the species.
 ! Here, in the interest of simplicity, we assume unsolvated K+ and Cl-
 ! ions, whose ionic radii we average. This gives a rough guess for
 ! the solvent radius.

%block species_solvent_radius
C 3.04
H 3.04
N 3.04
%endblock species_solvent_radius

 ! Smoothing of the transition between electrolyte-accessible and 
 ! electrolyte-inaccesible parts of the system.
 is_hc_steric_smearing              0.4 bohr

 ! The above corresponds to this:
 ! ---------------------------------------------------------------
 ! |      Atomic hard-core steric potential radial cut-offs      |
 ! +-------------------------------------------------------------+
 ! |   Species |   Symbol |            Radial cut-off (bohr)     |
 ! |           |          |     solute      solvent        total |
 ! |         1 |        C |   2.945990 +   3.040000 =   5.985990 |
 ! |         2 |        H |   2.219313 +   3.040000 =   5.259313 |
 ! |         3 |        N |   2.808511 +   3.040000 =   5.848511 |
 ! ---------------------------------------------------------------

%block sol_ions
  K +1 1.5
 Cl -1 1.5
%endblock sol_ions

 ! ------------------------------------

 print_qc T
 output_detail VERBOSE
 timings_level 0
 write_denskern F
 write_tightbox_ngwfs F
 do_properties F

 charge +1

 ngwf_threshold_orig : 0.000002
 kernel_cutoff : 1000
 elec_cg_max 0
 occ_mix 1.0
 xc_functional PBE

 ! Turns on solvation
 is_implicit_solvent T
 is_include_apolar T
 is_smeared_ion_rep T

 ! Parameters of the implicit solvent model 
 is_solvent_surf_tension 0.07415 N/m
 is_apolar_scaling_factor 0.281075
 is_solvation_beta 1.3
 is_density_threshold 0.00035
 is_bulk_permittivity 78.54
 is_dielectric_model fix_initial

 ! These will make the run reasonably short
 maxit_pen 0
 maxit_ngwf_cg 1
 minit_lnv 2
 maxit_lnv 2

 cutoff_energy 827 eV

 %block lattice_cart
  48.000   0.000   0.000
   0.000  48.000   0.000
   0.000   0.000  48.000
 %endblock lattice_cart

 %block positions_abs
C      17.85403817    21.92637647    22.14180411
H      19.39415683    21.87724385    23.50806889
H      16.38194929    23.16791998    22.87123454
C      16.73343649    19.30534017    21.73362542
H      15.11772919    19.46974548    20.46751560
H      16.10983016    18.56646116    23.55153236
C      18.62126293    17.45152863    20.58278829
H      17.69152258    15.65440857    20.20295534
H      20.18783761    17.15106376    21.88480271
N      19.58879759    18.57024059    18.15072361
H      18.04112007    18.89149234    17.08114427
C      20.80955423    21.09868080    18.44740904
H      21.39725595    21.81299350    16.60682551
H      22.45360728    20.94183436    19.67950397
C      18.87259517    22.88824199    19.62092277
H      19.76643091    24.71937694    19.92705678
H      17.29657191    23.10366963    18.31134948
C      21.24229922    16.76367195    16.78256911
H      22.75407214    16.18352909    18.05434808
H      22.04353887    17.67451514    15.11772919
H      20.14815357    15.11772919    16.20431597
 %endblock positions_abs

 %block species
 C   C   6 4 8.0
 H   H   1 1 8.0
 N   N   7 4 8.0
 %endblock species

 %block species_pot
 C   "../../pseudo/carbon.recpot"
 H   "../../pseudo/hydrogen.recpot"
 N   "../../pseudo/nitrogen.recpot"
 %endblock species_pot
