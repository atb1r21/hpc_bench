!====================================================!
! Input for calculation with the ONETEP program      !
!                                                    !
! Quality Control file for POLARISABLE EMBEDDING     !
! in the presence of spin-polarisation.              !
! No DMA charge scaling. No Bessel averaging.        !
! Filtered SWEX is tested too.                       !
! Polarisation interactions handled via QM*.         !
! Permanent interactions handled via QM*.            !
!                                                    !
! QM: acetonitrile anion                             !
! MM: K+ and H2O                                     !
!                                                    !
! Created on 2017/06/28 by                           !
! Jacek Dziedzic                                     !
! School of Chemistry                                !
! University of Southampton                          !
! Highfield                                          !
! Southampton SO17 1BJ                               !
! UK                                                 !
!                                                    !
!====================================================!

!----------------------------------------------------!
! This test does not require (or use) TINKER or any  !
! other implementation of AMOEBA. The response of    !
! the MM environment has been pre-generated in       !
! advance and is stored in the .mpoles_for_onetep    !
! file. In this way this calculation can be run      !
! using the standard QC approach, using only ONETEP  !
! and does not test the TINKTEP scripts.             !
!-----------------------------------------------------
! It is imperative that the auxiliary files          !
! - $QM2MM.lock                                      !
! - $MM2QM.lock                                      !
! - QM_acetonitrile_in_MM_H2O_K+.mpoles_for_onetep   !
! are not removed. Please do not modify any of these !
! files, except $QM2MM.lock, the contents of which   !
! are irrelevant.                                    !
!-----------------------------------------------------

print_qc             : TRUE
output_detail        : VERBOSE
timings_level        : 3

charge -1

! ---------------------------
! ----------- DMA -----------
! ---------------------------

    %block swri
      for_scf_dma 2 12 V 14 14 R
    %endblock swri

    %block species_swri-for_scf_dma
    H
    C
    N
    %endblock species_swri-for_scf_dma

    dma_calculate T 
    dma_use_ri for_scf_dma
    dma_max_l 1
    dma_max_q 11
    dma_metric ELECTROSTATIC
    dma_bessel_averaging F
    dma_scale_charge F

! -----------------------------
! --- POLARISABLE EMBEDDING ---
! -----------------------------

    pol_emb_vacuum_qmstar F
    pol_emb_dma_min_l 0
    pol_emb_dma_max_l 1
    pol_emb_mpole_exclusion_radius 1.00 bohr    
    pol_emb_pot_filename QM_acetonitrile_in_MM_H2O_K+.mpoles_for_onetep

do_properties T
cube_format F
                                                                                
write_forces T
xc_functional PBE

minit_lnv 5
maxit_lnv 5

maxit_ngwf_cg 2

write_denskern F
write_tightbox_ngwfs F

read_denskern F
read_tightbox_ngwfs F

coulomb_cutoff_type SPHERE
coulomb_cutoff_radius 30.0 bohr
coulomb_cutoff_write_int F

%block species_atomic_set                                                       
H  "SOLVE"
C  "SOLVE"
N  "SOLVE"
%endblock species_atomic_set                                                    

%block species                                                                  
H  H 1 1 8.0                                                                    
C  C 6 4 8.0
N  N 7 4 8.0
%endblock species                                                               

%block species_pot
H   "../../pseudo/hydrogen.recpot"
N   "../../pseudo/nitrogen.recpot"
C   "../../pseudo/carbon.recpot"
%endblock species_pot

cutoff_energy 800 eV

%block lattice_cart
     30.000000000       0.000000000       0.000000000
      0.000000000      30.000000000       0.000000000
      0.000000000       0.000000000      30.000000000
%endblock lattice_cart

! Positions obtained from QM_acetonitrile_in_MM_H2O_K+_qm.xyz, translated to the centre of QM_acetonitrile_in_MM_H2O_K+.dat.template
! by qm_xyz_to_dat on Wed Jun 28 11:00:57 BST 2017. Translation vector [a0]: 0.514664385 1.119396587 1.000005580.

%block positions_abs
C        14.514658805     15.652909825     15.000000000
C        14.514479281     12.894395342     15.000000000
H        16.456562157     12.164343118     15.000000000
H        13.543437843     12.164416817     16.681933729
H        13.543437843     12.164416817     13.318066270
N        14.514889351     17.835656882     15.000000000
%endblock positions_abs

! Thole polarisabilities obtained from QM_acetonitrile_in_MM_H2O_K+_qm.xyz and amoeba_acetonitrile_K+_water.prm.
! by qm_xyz_to_dat (with atom_number_to_polarisability doing all the dirty work) on Wed Jun 28 11:00:57 BST 2017.
! They have been converted from A^3 to a0^3.

%block thole_polarisabilities
C 9.069761559869 ! Cyanide Ion C
C 9.002278214929 ! Alkane CH3-
H 3.347173908999 ! Alkane H3C-
H 3.347173908999 ! Alkane H3C-
H 3.347173908999 ! Alkane H3C-
N 7.240962912008 ! Cyanide Ion N
%endblock thole_polarisabilities
