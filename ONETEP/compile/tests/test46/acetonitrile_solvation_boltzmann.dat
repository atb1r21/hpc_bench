!=========================================================!
! Input for calculation with the ONETEP program           !
!                                                         !
! Quality Control file for:                               !
! Implicit solvent (with a self-consistently updated      !
! cavity) for a neutral molecule, smeared ions,           !
! the open-BC realspace local pseudopotential and         !
! fine_grid_scale. Solvation forces are not yet tested.   !
! This QC test will test the Poisson-Boltzmann equation,  !
! which takes into account ionic species in solution.     !
! The test case is acetonitrile.                          !
!                                                         !
! Created by J. Dziedzic on 09/07/2014.                   !
! Modified by J. Dziedzic on 12/10/2014 to temporarily    !
! use zero BCs and no defect correction.                  !
! Modified by J. Dziedzic on 20/11/2019 to use the new    !
! steric potential.                                       !
!                                                         !
! School of Chemistry                                     !
! University of Southampton                               !
! Highfield                                               !
! Southampton SO17 1BJ                                    !
! UK                                                      !
!                                                         !
!=========================================================!

 ! Uncomment to use defect correction code in ONETEP, rather than the default,
 ! which is to have DL_MG perform defect correction
 !devel_code: MG:USE_ONETEP_DEFCO=T:MG

 ! This test does not restart from a converged vacuum calculation,
 ! and uses a rather coarse grid, which both impact convergence. 
 ! Furthermore, only two NGWF iterations are performed. 
 ! For these reasons the obtained total energy is not very meaningful
 ! and neither are the forces.
 ! This is a Quality Control test, not a production calculation.

 is_core_width 0.0
 write_forces F

 ! --- Poisson-Boltzmann parameters ---
 is_pbe                    full
 is_pbe_temperature        300.0
 is_pbe_bc_debye_screening F

 is_steric_pot_type M ! smoothed hard-sphere potential

 ! Electronic-isovalue-based component to the electrolyte accessibility
 ! radius. This models the solute and is hopefully reasonably transferable.
 ! The below is reasonable, but not a final parameterisation.
 is_hc_steric_dens_isovalue 0.002

 ! Constant offset component to the electrolyte accessibility radius.
 ! This models the electrolyte and so will depend on the species.
 ! Here, in the interest of simplicity, we assume unsolvated Mg+ and Cl-
 ! ions, whose ionic radii we average. This gives a rough guess for
 ! the solvent radius.

%block species_solvent_radius
H 2.42
C 2.42
N 2.42
%endblock species_solvent_radius

 ! Smoothing of the transition between electrolyte-accessible and 
 ! electrolyte-inaccesible parts of the system.
 is_hc_steric_smearing              0.4 bohr

%block sol_ions
 Mg +2 0.1
 Cl -1 0.2
%endblock sol_ions

 ! ------------------------------------

 print_qc T
 output_detail VERBOSE
 timings_level 0
 write_denskern F
 write_tightbox_ngwfs F
 do_properties F

 charge 0

 ngwf_threshold_orig : 0.000002
 kernel_cutoff : 1000
 elec_cg_max 0
 occ_mix 1.0
 xc_functional PBE

 fine_grid_scale 3.0

 ! Turns on solvation
 is_implicit_solvent T
 is_include_apolar T
 is_smeared_ion_rep T

 ! Parameters of the implicit solvent model 
 is_solvent_surf_tension 0.07415 N/m
 is_apolar_scaling_factor 0.281075
 is_solvation_beta 1.3
 is_density_threshold 0.00035
 is_bulk_permittivity 78.54
 is_dielectric_model self_consistent

 mg_granularity_power 5
 mg_defco_fd_order 2

 ! Numerical details
 is_smeared_ion_width 0.8
 is_bc_coarseness 0
 
 ! These will make the run reasonably short
 maxit_pen 0
 maxit_ngwf_cg 1
 minit_lnv 1
 maxit_lnv 1


 psinc_spacing 0.5 0.5 0.5

 %block lattice_cart
  27.5000000   0.0000000   0.0000000
   0.0000000  27.5000000   0.0000000
   0.0000000   0.0000000  27.5000000
 %endblock lattice_cart

 %block positions_abs
C      14.00000000      14.53351903      14.00000000
C      13.99982048      11.77500345      14.00000000
H      15.94190413      11.04495093      14.00000000
H      13.02877865      11.04502463      15.68193440
H      13.02877865      11.04502463      12.31806560
N      14.00023055      16.71626696      14.00000000
 %endblock positions_abs

%block species
 H   H   1 1 7.0
 C   C   6 4 7.0
 N   N   7 4 7.0
%endblock species

%block species_pot
 H   "../../pseudo/hydrogen.recpot"
 C   "../../pseudo/carbon.recpot"
 N   "../../pseudo/nitrogen.recpot"
%endblock species_pot

